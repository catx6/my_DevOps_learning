TCP - transmission control protocol - протокол L4 транспортного уровня
отвечает за надежность передачи данных

IP - это адрес
TCP - письмо с надежным почтальеном

#### плюсы
- Гарантирует максимальную безопасность данных и их качество
#### минусы
- не сильная скорость в отличии от UDP

### как устанавливается соединение
#### 3-way handshake
1 SYN - запрос на соединени
2 SYN-ACK - ответ сервера на готовность
3 ACK - соединение

### передача данных
- TCP делит поток на байты
- каждый сегмент получает номер последовательности (seq)
- получатель отправляет ACK подтверждение с номером следующего ожидаемого байта
- Если ACK не прошел байт считается потеряным и сообщение пересылается заново

#### завершение соединения

4-way-teardown - четырех этапное закрытие соединения
1. клиент посылает FIN
2. сервер подтверждает ACK
3. сервер посылает свой FIN
4. клиент подтверждает ACK

TCP - важен т.к используется везде
ssh
http/https
smtp

| Инструмент                   | Что делает                     |
| ---------------------------- | ------------------------------ |
| `netstat -tulnp`             | показывает слушающие TCP-порты |
| `ss -tn state established`   | активные соединения            |
| `nc -vz host port`           | проверка TCP-доступности       |
| `tcpdump -i eth0 tcp`        | просмотр TCP-пакетов           |
| `curl -v http://example.com` | отладка TCP+HTTP               |
| `telnet host port`           | проверка соединения вручную    |
### как создавать TCP пакеты
- __первый простой способ с пожатием__
	```python
	import socket
	
	#создает TCP-сокет (IPv4, TCP)
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	#подключение к серверу google.com:80
	s.connect(("google.com", 80))
	#отправка http запроса
	s.send(b"GET / HTTP/1.1\r\nHOST: google.com\r\n\r\n")
	
	#читаем ответ
	data = s.recv(1024)
	print(data.decode())
	
	s.close()
	```
### что важно знать
- TCP пакет создается ОС
- также делает SYN->SYN/ACK->ACK
- потом отправляет GET
- получает ответ и делает закрытие соединения FIN->ACK->FIN->ACK
- s.send(b"GET / HTTP/1.1\r\nHost: google.com\r\n\r\n") передается в байтах

#### сложный способ где все сам
```python
from scapy.all import *

# Создаем IP-заголовок
ip = IP(dst="8.8.8.8", src="192.168.1.10")

# Создаем TCP-заголовок
tcp = TCP(sport=12345, dport=80, flags="S", seq=1000)

# Формируем пакет
pkt = ip / tcp

# Отправляем пакет
send(pkt)
```
- создается с sudo прав
- это только SYN запрос на соединение после ответа сервера соединения не будет
