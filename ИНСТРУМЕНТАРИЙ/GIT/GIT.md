GIT - распределенная система контроля версий
**Главная идея - отслеживание изменений в коде и работать с историей кода**
- **локальный репозиторий** - копия проекта или только его начало копируется командой `git clone`
- **удаленый репозиторий** - на сервере **github.com** **GitLab** **Gitea** **Bitbucket**


| команда                      | описание                                                                                                |
| ---------------------------- | ------------------------------------------------------------------------------------------------------- |
| `git init`                   | важная часть это инициализация проекта                                                                  |
| `git clone <URL>`            | клонировать удаленый репозиторий                                                                        |
| `git status`                 | посмотреть какие файлы изменились                                                                       |
| `git add .`                  | добавить изменения в индекс(staging)                                                                    |
| `git commit -m "commit"`     | фиксация изменения                                                                                      |
| `git push <remote> <branch>` | отправить последний коммит на локальной ветке часто **master** в удаленную ветку часто **origin**       |
| `git pull`                   | загрузка изменений из удаленного репозитория и их автоматического объединения с текущей локальной ветки |
| `git log`                    | показать историю коммитов                                                                               |
| `git diff`                   | показать различия между версиями                                                                        |

----

#### работа с ветками

| команда                    | что делает                                                                                                         |
| -------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| `git branch`               | список веток                                                                                                       |
| `git branch <branch>`      | создать ветку                                                                                                      |
| `git checkout <branch>`    | перейти на ветку                                                                                                   |
| `git checkout -b <branch>` | создать и перейти на ветку                                                                                         |
| `git merge <branch>`       | слив текущей ветки с указаной                                                                                      |
| `git rebase <master>`      | переписывает историю относительно main полезно когда создаешь новую ветку и надо переделать все файлы на эту ветку |
| `git branch -d <branch>`   | удаляет ветку                                                                                                      |
 - **rebase** - переписывает все файлы на текущую ветку
 - merge - создает merge-commit

---

## работа с удаленным репозиторием

| команда                                                        | что делает                                                                 |
| -------------------------------------------------------------- | -------------------------------------------------------------------------- |
| `git remote -v`                                                | показывает список удаленных репозиториев                                   |
| `git remote add origin <url>`                                  | добавить удаленный репозиторий                                             |
| `git push -u origin main`                                      | отправить ветку на сервер                                                  |
| `git fetch`                                                    | создает новую ветку с обновленными данными в общем git clone с новой ветки |
| `git pull --rebase`                                            | обновить и переписать историю поверх новых коммитов                        |
| `git remote add <https://user:TOKEN@github.com/user/repo.git>` | добавление токена удаленной ветки                                          |

-----

### история и откат изменений


| команда                                | что делает                                            |
| -------------------------------------- | ----------------------------------------------------- |
| `git log --oneline --graph --decorate` | красивая история                                      |
| `git reset --hard <hash>`              | полный откат к комиту                                 |
| `git revert <hash>`                    | создать новый коммит отменяющий старый                |
| `git stash`                            | временно убрать незакоммиченные изменения             |
| `git stash pop`                        | вернуть их обратно                                    |
| `git reset --mixed HEAD~1`             | отменить коммит и снова увидеть изменения как modifed |

| Цель                                 | Команда                    | Что остаётся |
| ------------------------------------ | -------------------------- | ------------ |
| Удалить коммит, сохранить изменения  | `git reset --soft HEAD~1`  | staged       |
| Удалить коммит, вернуть в unstaged   | `git reset --mixed HEAD~1` | modified     |
| Полностью стереть коммит и изменения | `git reset --hard HEAD~1`  | ничего       |
| Отменить коммит без удаления истории | `git revert HEAD`          | новый коммит |
### инструменты для DevOps

Командные патерны:
- работа с тегами
```bash
git tag -a v1.0 -m "release 1.0"
git push origin v1.0
```
- изменить последний коммит
```bash
git commit --amend -m "новое описание"
```
- интерактивный rebase (чистка истории)
```bash
git rebase -i HEAD~5
```
позволяет объединять удалять переименовывать коммиты
- cherry-pick (перенос одного коммита)
```bash
git cherry-pick <hash>
```

---

#### Как работает GIT

Git - создан на языке C с компонентами на Shell и Perl
Главная идея git - это не файлы а **база данных объектов**

Он хранит **контент как набор объектов** в **key-value хранилище** 

Каждый объект сохраняется в `.git/objects/` и иденфицируется как SHA-1 или SHA-256


| тип объекта | что хранит                                                    | пример                |
| ----------- | ------------------------------------------------------------- | --------------------- |
| **blob**    | содержимое файла                                              | текст кода, документа |
| **tree**    | структура папок(**список blob** и **trees**)                  | папка с файлами       |
| commit      | указатель на tree+метаданные (автор время сообщение родитель) | версия проекта        |
| tag         | подпись метка на commit                                       | `v1.0`                |
- Все объекты связаные через `хэши` образуя **ациклический граф (DAG)** истории коммитов

### Как работает хэширование

1. `git add file.txt`
2. Git создает blob: `echo "hello" | git hash-object -w --stdin`
3. возвращает хэш и сохраняется в `.git/objects/5b/<HASH>`
4. каждый объект хранится вечно пока не удалится `git gc`

### как git определяет ветки
Ветка - это указатель на коммит
файлы с ветками лежат в `.git/refs/heads/`

---

### команды

##### git cherry pick
Что делает: Копирует один конкретный коммит из другой ветки и применяет его поверх текущей

```bash
git checkout main
git cherry-pick <hash>
```


----

чем отличается `merge` от `rebase`

| merge                      | rebase                       |
| -------------------------- | ---------------------------- |
| создаёт merge-коммит       | переписывает историю         |
| сохраняет реальную историю | делает её линейной           |
| безопасен для общих веток  | использовать только локально |

----

### вопросы

- [GIT](https://github.com/Swfuse/devops-interview/blob/main/interview.md#git)
    - [Чем merge отличается от rebase?](https://github.com/Swfuse/devops-interview/blob/main/interview.md#%D1%87%D0%B5%D0%BC-merge-%D0%BE%D1%82%D0%BB%D0%B8%D1%87%D0%B0%D0%B5%D1%82%D1%81%D1%8F-%D0%BE%D1%82-rebase)
    - [Когда нужно использовать merge, когда rebase?](https://github.com/Swfuse/devops-interview/blob/main/interview.md#%D0%BA%D0%BE%D0%B3%D0%B4%D0%B0-%D0%BD%D1%83%D0%B6%D0%BD%D0%BE-%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D1%8C-merge-%D0%BA%D0%BE%D0%B3%D0%B4%D0%B0-rebase)
    - [Чем отличается git pull и git fetch](https://github.com/Swfuse/devops-interview/blob/main/interview.md#%D1%87%D0%B5%D0%BC-%D0%BE%D1%82%D0%BB%D0%B8%D1%87%D0%B0%D0%B5%D1%82%D1%81%D1%8F-git-pull-%D0%B8-git-fetch)
    - [Что такое cherry pick ?](https://github.com/Swfuse/devops-interview/blob/main/interview.md#%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-cherry-pick-)
    - [Какие пратики работы с гитом вы знаете? Форки](https://github.com/Swfuse/devops-interview/blob/main/interview.md#%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5-%D0%BF%D1%80%D0%B0%D1%82%D0%B8%D0%BA%D0%B8-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D1%81-%D0%B3%D0%B8%D1%82%D0%BE%D0%BC-%D0%B2%D1%8B-%D0%B7%D0%BD%D0%B0%D0%B5%D1%82%D0%B5-%D1%84%D0%BE%D1%80%D0%BA%D0%B8)
    - [Что такое GitFlow?](https://github.com/Swfuse/devops-interview/blob/main/interview.md#%D1%87%D1%82%D0%BE-%D1%82%D0%B0%D0%BA%D0%BE%D0%B5-gitflow)
