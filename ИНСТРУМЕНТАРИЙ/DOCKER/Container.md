Docker container - это запущенный [[Image]], также это изолированная среда собранная [[Image]]

`docker run -d -p 8080:80 nginx`

1. првоеряет есть ли образ `nginx` локально
2. если нету скачивает его с Docker Hub
3. создает контейнер изолированное окружение
4. назначает ему
	- файловую систему
	- PID namespace
	- сетевой namespace
	- ограничение по ресурсам через cgroups
5. запускает процесс внутри `nginx`

---

контейнер состоит из:

| компонент        | описание                                       |
| ---------------- | ---------------------------------------------- |
| файловая система | собрана из образа + верхний writable слой      |
| сетевой стек     | изолирован (Bridge, Host, Overlay)             |
| процессы         | изолированные PID namespace                    |
| Cgroups          | контроль ресурсов                              |
| Volumes          | подключенные постоянные диски                  |
| config           | параметры запуска порты и переменные окружения |

---

### работа из под капота

1. создает новые namespaces:
	- PID -> свой список процессов
	- NET -> собственный ip, интерфейсы
	- MNT -> своя файловая система
	- UTS -> свое имя хоста
	- IPC -> своя память между процессами
	- USER -> изоляция пользователей
2. применяет cgroups `docker run --memory=512m --cpus=1 nginx`
3. монтирует FS через OverlayFS
4. запускает основной процесс **CMD**

---

### команды и флаги


| команда                          | что делает                                                        |
| -------------------------------- | ----------------------------------------------------------------- |
| `docker ps`                      | список запущенных контейнеров                                     |
| `docker ps -a`                   | все контейнеры **включая остановленные**                          |
| `docker run`                     | запуск контейнера                                                 |
| `docker exec -it <id> /bin/bash` | войти внутрь контейнера или использовать команду(`/bin/hostname`) |
| `docker logs <id>`               | просмотр логов                                                    |
| `docker stop <id>`               | остановка контейнера                                              |
| `docker rm <id>`                 | удаление контейнера                                               |
| `docker inspect <id>`            | полная информация о контейнере                                    |
| `docker stats`                   | мониторинг ресурсов                                               |
| `docker container prune`         | удаление всех остановленных контейнеров                           |

#### флаги


| команда                    | флаг                               | особенность                               |
| -------------------------- | ---------------------------------- | ----------------------------------------- |
| `docker ps`                | `--filter "status=exited"`         | фильтрация по статусу, имени и т.д        |
|                            | `-q`                               | вывести только ID                         |
| `docker run`               | `-d`                               | запустить в фоновом режиме                |
|                            | `-p`                               | пробросить порты (локальный:контейнерный) |
|                            | `--name`                           | задать имя                                |
|                            | `-v /data:/usr/share/nginx/html`   | монтировать том или директорию            |
|                            | `--rm alpine`                      | удалить контейнер после завершения        |
| `docker exec`              | `-i`                               | интеракцивный режим (stdin открыт)        |
|                            | `-t`                               | выделить tty (псевдотерминал)             |
| `docker rm` / `docker rmi` | `-f`                               | принудительное удаление даже если запущен |
| `docker build`             | `-t myapp:1.0`                     | задать тег                                |
|                            | `-f /path`                         | указать путь DockerFile                   |
|                            | `--no-cache`                       | собрать без кэша слоев                    |
| `docker logs`              | `-f`                               | следить в реальном времени                |
|                            | `--tail 100`                       | показать последние 100 строк              |
| `docker inspect`           | `-f {{.NetworkSettings.IPAdress}}` | выведет только IP                         |
| `docker compose`           | `-d`                               | запуск в фоне                             |
|                            | `--build`                          | пересобрать образы перед запуском         |
|                            | `--remove-orphans`                 | удалить контейнеры не описанные в yaml    |

----


