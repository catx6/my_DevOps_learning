threads - ключевое понимание как работают процессы
потоки важны для понимания как работают сервисы контейнеры а также при разработке
еще с точки зрения не разработки а **анализа** производительности и нагрузки понимание потоков **очень важно**

-----

### что такое поток
**Thread** - внутренний под-процесс внутри процессора он разделяет память и ресурсы с другими потоками того же процесса но выполняется парарельно
- процесс - контейнер с памятью файловыми дескрипторами и переменными среды
- поток - нить исполнения внутри этого контейнера (процесса)
Один процесс может использовать множество потоков

`ps -eLf | grep nginx`

```yaml
root     1234  1233  1234  5    1 12:00 ?  00:00:00 nginx: master process
www-data 1235  1234  1235  5    1 12:00 ?  00:00:00 nginx: worker process
```
LWP - идентификатор потока

### как создаются потоки
как посмотреть потоки 
- через top -> нажать H для интерактивного режима
- htop -> F2 -> display options -> show threads
- через `/proc`
	```bash
	ls /proc/1234/task
	```

------
#### создание на C

```C
#include <pthread.h>
#include <stdio.h>

void* worker(void* arg) {
    printf("Поток выполняется!\n");
    return NULL;
}

int main() {
    pthread_t thread;
    pthread_create(&thread, NULL, worker, NULL);
    pthread_join(thread, NULL);
    return 0;
}

```
Этот код создаёт новый поток и ждёт его завершения.  
В системном вызове это реализуется через `clone()` — тот же механизм, что и в Docker и namespaces

-----

### потоки и DevOps

| Сфера                  | Что важно                                                                                                      |
| ---------------------- | -------------------------------------------------------------------------------------------------------------- |
| **Мониторинг**         | Метрики `threads`, `context switches`, `loadavg` через Prometheus, Node Exporter                               |
| **Производительность** | Анализ CPU-bound процессов (например, Java или Python, где потоки не дают реального параллелизма из-за GIL)    |
| **Настройка сервисов** | Указание числа потоков в `nginx`, `gunicorn`, `postgresql.conf` (`max_worker_threads`)                         |
| **Отладка**            | Через `gdb`, `strace -f` или `pstree` можно увидеть ветвление и выполнение потоков                             |
| **Контейнеризация**    | Docker и Kubernetes используют те же системные вызовы (`clone`) для создания изолированных потоков и процессов |

----

### как посмотреть статитстику
```bash
cat /proc/loadavg
```
3 первых числа это средняя загрузка **CPU** которая зависит от потоков ожидающих cpu

```bash
ps -eLf | wc -l
```

| Команда                  | Назначение                             |
| ------------------------ | -------------------------------------- |
| `ps -eLf`                | список всех потоков                    |
| `top -H`                 | мониторинг потоков                     |
| `htop`                   | визуальный мониторинг                  |
| `cat /proc/<pid>/status` | см. поле `Threads:`                    |
| `pidstat -t`             | статистика по потокам                  |
| `strace -f -p <pid>`     | отладка системных вызовов всех потоков |