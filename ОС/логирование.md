логирование - процесс записи событий происходящих в системе или приложении в специальные файлы или внешние системы для анализа, диагностики и мониторинга

---
### виды логов

1. системные - ядро, драйверы, сервисы Linux (`/var/log/syslog`, `/var/log/messages`, `journalctl`)
2. приложенчиские - логи конкретных программ `/var/log/nginx/acess.log`, `/var/log/mysql/error.log`
3. безопасность - попытки входа,sudo (`/var/log/auth.log`)
4. сетевые - пакеты, соединения, firewall
5. CI/CD и DevOps-пайплайны - логи сборок, тестов, деплоев

| Уровень              | Назначение                                                 |
| -------------------- | ---------------------------------------------------------- |
| DEBUG                | Подробная отладочная информация                            |
| INFO                 | Нормальные рабочие сообщения                               |
| WARNING              | Что-то необычное, но не ошибка                             |
| ERROR                | Ошибка, требующая внимания                                 |
| CRITICAL (или FATAL) | Критическая ошибка — приложение не может продолжать работу |
#### python
```python
import logging

# Настройка логирования
logging.basicConfig(
    filename='app.log',          # файл для записи
    level=logging.DEBUG,         # уровень логирования
    format='%(asctime)s - %(levelname)s - %(message)s'  # формат
)

logging.debug('Отладочная информация')
logging.info('Программа запущена')
logging.warning('Что-то пошло не так')
logging.error('Ошибка при обработке данных')
logging.critical('Критическая ошибка!')
```

----

#### форматы логов
- **текстовые логи** - простые строки
- **JSON логи** - структурированные, удобно парсить и анализировать
- **Журналы systemd (journald)** - бинарные, просматриваются через `journalctl`


| цель                | инструменты                                                                                 |
| ------------------- | ------------------------------------------------------------------------------------------- |
| сбор логов          | Fliebeat, Fluentd, Logstash                                                                 |
| Хранение            | Elasticsearch, Loki                                                                         |
| просмотр и анализ   | Kibana, Grafana, Graylog                                                                    |
| централизация логов | ELK Stack (Elasticsearch + Logstash + Kibana), EFK Stack (Elasticsearch + Fluentd + Kibana) |

----

#### практика DevOps-инженера
- логи контейнеров в **Docker** - `docker logs <container>`
- k8s: `kubectl logs <pod>`
- настройка агентов например `Filebeat` для отправки логов в Elasticsearch
- настройка дашбордов в [[Grafana]] или Kibana для анализа

----
### journalctl

```bash
journalctl -xe
journalctl -u nginx.service
journalctl --since "2025-11-01" --until "2025-11-09"
```

#### базовые флаги

| Флаг                                          | Описание                                                   |
| --------------------------------------------- | ---------------------------------------------------------- |
| `-n N`                                        | показать последние N строк                                 |
| `-f`                                          | "follow" — как `tail -f`, смотреть логи в реальном времени |
| `-r`                                          | показать логи в обратном порядке (новые сверху)            |
| `-e`                                          | перейти в конец лога                                       |
| `-x`                                          | добавить расшифровку сообщений systemd                     |
| `-o short`, `-o json`, `-o cat`, `-o verbose` | выбрать формат вывода (удобно для скриптов)                |

#### фильтрация по сервисам и юнитам

| Флаг                  | Описание                                                                              |
| --------------------- | ------------------------------------------------------------------------------------- |
| `-u <unit>`           | показывать только логи конкретного сервиса (например `nginx.service`, `sshd.service`) |
| `_PID=1234`           | по PID процесса                                                                       |
| `_UID=1000`           | по пользователю                                                                       |
| `_COMM=nginx`         | по имени команды                                                                      |
| `_EXE=/usr/bin/nginx` | по пути к исполняемому файлу                                                          |

#### флаги фильтрации по времени 

| Флаг                            | Описание              |
| ------------------------------- | --------------------- |
| `--since "YYYY-MM-DD HH:MM:SS"` | с указанного времени  |
| `--until "YYYY-MM-DD HH:MM:SS"` | до указанного времени |
| `--since yesterday`             | с вчерашнего дня      |
| `--since "1 hour ago"`          | за последний час      |
| `--since today`                 | за сегодня            |

##### системные и пользовательские журналы
| Флаг                          | Описание                             |
| ----------------------------- | ------------------------------------ |
| `--system`                    | только системные логи (root, демоны) |
| `--user`                      | только пользовательские логи         |
| `-u <unit> --user`            | логи юнитов пользователя             |
| `--directory=/путь`           | открыть журнал из другой директории  |
| `--file=/var/log/journal/...` | открыть конкретный файл журнала      |

##### очистка и управление журналом
| Флаг                 | Описание                                    |
| -------------------- | ------------------------------------------- |
| `--disk-usage`       | показать, сколько места занимают логи       |
| `--vacuum-size=500M` | очистить старые логи, оставив только 500 МБ |
| `--vacuum-time=7d`   | удалить логи старше 7 дней                  |
| `--rotate`           | вручную начать ротацию журналов             |

#### работа с Boot-сессиями

| Флаг           | Описание                                            |
| -------------- | --------------------------------------------------- |
| `-b`           | логи текущего запуска системы                       |
| `-b -1`        | логи предыдущего запуска                            |
| `-b -2`        | два запуска назад                                   |
| `--list-boots` | показать список всех загрузок с их идентификаторами |

#### особо важные

|Команда|Что делает|
|---|---|
|`journalctl -xe`|показать последние ошибки с контекстом (часто используют при отладке)|
|`journalctl -u nginx -f`|смотреть логи nginx в реальном времени|
|`journalctl -b -1 -p err`|ошибки с прошлого запуска системы|
|`journalctl --since "10 min ago" -p warning`|предупреждения за последние 10 минут|
|`sudo journalctl --disk-usage`|узнать размер всех журналов|
|`sudo journalctl --vacuum-time=30d`|удалить логи старше 30 дней|
